<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ToB åå°ç®¡ç†ç³»ç»Ÿ</title>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <style>
    body { font-family: Arial; margin: 20px; }
    h2 { margin-top: 40px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f5f5f5; }
    button { padding: 5px 10px; margin-bottom: 10px; }
    .box { border: 1px solid #ddd; padding: 15px; margin-top: 10px; }
  </style>
</head>

<body>
<div id="app">

  <!-- å•†å“ / åº“å­˜ç®¡ç† -->
  <h2>ğŸ“¦ å•†å“åº“å­˜ç®¡ç†</h2>
  <button @click="loadProducts">æŸ¥è¯¢å•†å“</button>

  <table>
    <tr>
      <th>ID</th>
      <th>å•†å“å</th>
      <th>ä»·æ ¼</th>
      <th>åº“å­˜</th>
    </tr>
    <tr v-for="p in products" :key="p.id">
      <td>{{ p.id }}</td>
      <td>{{ p.name }}</td>
      <td>{{ p.price }}</td>
      <td>{{ p.stock }}</td>
    </tr>
  </table>

  <!-- è®¢å•ç®¡ç† -->
  <h2>ğŸ“„ è®¢å•ç®¡ç†</h2>
  <button @click="loadOrders">æŸ¥è¯¢è®¢å•</button>

  <table>
    <tr>
      <th>è®¢å•ID</th>
      <th>ç”¨æˆ·ID</th>
      <th>æ€»é‡‘é¢</th>
      <th>çŠ¶æ€</th>
      <th>ç”µè¯</th>
      <th>åœ°å€</th>
      <th>åˆ›å»ºæ—¶é—´</th>
    </tr>
    <tr v-for="o in orders" :key="o.id">
      <td>{{ o.id }}</td>
      <td>{{ o.userId }}</td>
      <td>{{ o.totalPrice }}</td>
      <td>{{ o.status }}</td>
      <td>{{ o.phone }}</td>
      <td>{{ o.address }}</td>
      <td>{{ formatDate(o.createdAt) }}</td>
    </tr>
  </table>

  <!-- é”€å”®ç»Ÿè®¡ -->
  <h2>ğŸ“Š é”€å”®ç»Ÿè®¡</h2>
  <button @click="loadStatistics">åˆ·æ–°ç»Ÿè®¡</button>

  <div class="box">
    <p>è®¢å•æ€»æ•°ï¼š{{ statistics.orderCount }}</p>
    <p>é”€å”®æ€»é¢ï¼š{{ statistics.totalSales }}</p>
  </div>

  <!-- å®¢æˆ·ç®¡ç† -->
  <h2>ğŸ‘¤ å®¢æˆ·ç®¡ç†</h2>
  <button @click="loadCustomers">æŸ¥è¯¢å®¢æˆ·</button>

  <table>
    <tr>
      <th>å®¢æˆ·ID</th>
      <th>å§“å</th>
      <th>é‚®ç®±</th>
    </tr>
    <tr v-for="c in customers" :key="c.id">
      <td>{{ c.id }}</td>
      <td>{{ c.username }}</td>
      <td>{{ c.email }}</td>
    </tr>
  </table>

  <!-- å®¢æˆ·è¡Œä¸ºæ—¥å¿— -->
  <h2>ğŸ§¾ å®¢æˆ·è¡Œä¸ºæ—¥å¿—</h2>
  <button @click="loadLogs">æŸ¥è¯¢æ—¥å¿—</button>

  <table>
    <tr>
      <th>å®¢æˆ·ID</th>
      <th>è¡Œä¸º</th>
      <th>å•†å“ID</th>
      <th>æ—¶é—´</th>
    </tr>
    <tr v-for="l in logs" :key="l.id">
      <td>{{ l.id }}</td>
      <td>{{ l.action }}</td>
      <td>{{ l.productId }}</td>
      <td>{{ formatDate(l.time) }}</td>
    </tr>
  </table>

</div>

<script>
const { createApp } = Vue

createApp({
  data() {
    return {
      products: [],
      orders: [],
      statistics: {},
      customers: [],
      logs: []
    }
  },
  methods: {
    // å•†å“åº“å­˜
    loadProducts() {
      axios.get('http://localhost:8080/api/products/AllProducts')
        .then(res => this.products = res.data.list || res.data)
        .catch(err => console.error(err))
    },
    // è®¢å•ç®¡ç†
    loadOrders() {
      axios.get('http://localhost:8080/api/orders')
        .then(res => this.orders = res.data)
        .catch(err => console.error(err))
    },
    // é”€å”®ç»Ÿè®¡
    loadStatistics() {
      axios.get('http://localhost:8080/api/orders/statistics')
        .then(res => this.statistics = res.data)
        .catch(err => console.error(err))
    },
    // å®¢æˆ·ç®¡ç†
    loadCustomers() {
      axios.get('http://localhost:8080/api/customers')
        .then(res => this.customers = res.data)
        .catch(err => console.error(err))
    },
    // å®¢æˆ·æ—¥å¿—
    loadLogs() {
      axios.get('http://localhost:8080/api/customers/logs')
        .then(res => this.logs = res.data)
        .catch(err => console.error(err))
    },
    // æ ¼å¼åŒ–æ—¶é—´
    formatDate(datetimeStr) {
      if (!datetimeStr) return ''
      const d = new Date(datetimeStr)
      return d.toLocaleString()
    }
  }
}).mount('#app')
</script>

</body>
</html>
